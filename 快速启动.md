# 🚀 AI-Traveller 启动指南

## 最简单的启动方式（推荐）

### 步骤 1：配置环境变量

```bash
# 1. 复制模板文件
cp .env.example .env

# 2. 编辑文件（填入你的 API 密钥）
notepad .env    # Windows
nano .env       # Linux/macOS
```

**必须填写（最少需要）：**
```env
SUPABASE_URL=your_supabase_url_here
SUPABASE_ANON_KEY=your_supabase_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here
```

> 💡 获取 Supabase 密钥：https://app.supabase.com

### 步骤 2：启动服务

#### 方式 1：使用启动脚本（推荐）

**Windows PowerShell:**
```powershell
.\start.ps1
```

**Linux/macOS:**
```bash
chmod +x start.sh
./start.sh
```

#### 方式 2：直接使用 Docker Compose

```bash
docker-compose up -d
```

### 步骤 3：访问应用

打开浏览器：**http://localhost:8080**

完成！🎉

---

## 📋 管理命令

```bash
# 查看服务状态
docker-compose ps

# 查看实时日志
docker-compose logs -f

# 停止服务
docker-compose down

# 重启服务
docker-compose restart

# 重新构建并启动
docker-compose up -d --build
```

---

## 🔍 验证服务是否正常

### 1. 检查容器状态
```bash
docker-compose ps
```
应该看到容器状态为 "Up"

### 2. 查看日志
```bash
docker-compose logs --tail=50
```
应该看到：
```
✅ 环境变量配置完整
Supabase client initialised
API server listening on port 8080
```

### 3. 测试 API
```bash
curl http://localhost:8080/api/health
```
应该返回 `{"status":"ok"}`

---

## 📝 环境变量说明

### 最小配置（只配置核心功能）

```env
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIs...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIs...
```

有了这三个，你就可以：
- ✅ 用户注册和登录
- ✅ 创建和管理行程
- ✅ 记录旅行费用

### 完整配置（启用所有功能）

```env
# ===== 必需（核心功能）=====
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIs...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIs...

# ===== 可选（AI 行程规划）=====
LLM_API_URL=https://api.deepseek.com/v1
LLM_API_KEY=sk-xxxxx
LLM_MODEL=deepseek-chat

# ===== 可选（地图功能）=====
AMAP_WEB_SERVICE_KEY=xxxxx
VITE_AMAP_JS_KEY=xxxxx
VITE_AMAP_JS_SECURITY_CODE=xxxxx

# ===== 可选（语音识别）=====
IFLYTEK_APP_ID=xxxxx
IFLYTEK_API_KEY=xxxxx
IFLYTEK_API_SECRET=xxxxx
```

配置了所有服务，你可以：
- ✅ 所有核心功能
- ✅ AI 智能生成行程
- ✅ 地图路线规划
- ✅ 语音输入费用

---

## 🐛 常见问题

### 问题 1：端口 8080 被占用

**错误信息：**
```
Error: bind: address already in use
```

**解决方法：**

**Windows:**
```powershell
# 查找占用端口的进程
netstat -ano | findstr :8080

# 结束进程（替换 <PID> 为实际进程 ID）
taskkill /PID <PID> /F
```

**Linux/macOS:**
```bash
# 查找并杀死进程
lsof -ti:8080 | xargs kill -9
```

### 问题 2：找不到 .env 文件

**错误信息：**
```
❌ 错误：找不到 .env 文件
```

**解决方法：**
```bash
# 确认当前目录
pwd

# 应该在项目根目录
cd /path/to/AI-Traveller

# 复制模板
cp .env.example .env

# 编辑文件
notepad .env    # Windows
nano .env       # Linux/macOS
```

### 问题 3：Docker 未启动

**错误信息：**
```
Cannot connect to Docker daemon
```

**解决方法：**
- Windows/macOS: 启动 Docker Desktop
- Linux: `sudo systemctl start docker`

### 问题 4：环境变量没生效

**症状：**
- 服务启动了，但功能不正常
- 日志显示缺少环境变量

**解决方法：**
```bash
# 1. 检查 .env 文件内容
cat .env

# 2. 确保没有多余的空格或引号
# 正确格式：SUPABASE_URL=https://xxx.supabase.co
# 错误格式：SUPABASE_URL = "https://xxx.supabase.co"

# 3. 重新构建并启动
docker-compose down
docker-compose up -d --build
```

### 问题 5：Supabase 连接失败

**症状：**
- 登录失败
- 数据无法保存

**解决方法：**
```bash
# 1. 验证 Supabase 配置
docker-compose exec app env | grep SUPABASE

# 2. 检查 URL 格式
# 正确：https://xxxxx.supabase.co
# 错误：https://xxxxx.supabase.co/

# 3. 确认密钥有效
# 登录 https://app.supabase.com 验证
```

---

## 🔄 更新应用

```bash
# 1. 停止服务
docker-compose down

# 2. 拉取最新代码（如果使用 Git）
git pull

# 3. 重新构建
docker-compose up -d --build

# 4. 查看日志
docker-compose logs -f
```

---

## 📊 监控和日志

### 实时查看日志
```bash
# 所有日志
docker-compose logs -f

# 只看最近 100 行
docker-compose logs --tail=100

# 只看错误
docker-compose logs | grep -i error
```

### 导出日志
```bash
# 保存到文件
docker-compose logs > app.log
```

### 查看资源使用
```bash
docker stats
```

---

## 💡 快速测试

想快速测试服务是否正常？运行这些命令：

```bash
# 1. 检查服务状态
docker-compose ps

# 2. 测试健康检查
curl http://localhost:8080/api/health

# 3. 查看最近日志
docker-compose logs --tail=20
```

全部成功？恭喜！🎉 服务运行正常

---

## 🎯 下一步

服务启动成功后：

1. **打开浏览器** → http://localhost:8080
2. **注册账号** → 输入邮箱和用户名
3. **开始规划** → 创建你的第一个旅行计划！

需要帮助？
- 查看完整文档：[README.md](./README.md)
- Docker 详细说明：[DOCKER_START.md](./DOCKER_START.md)
- 环境变量配置：[docs/ENVIRONMENT_VARIABLES.md](./docs/ENVIRONMENT_VARIABLES.md)

---

**祝你旅途愉快！** 🌍✈️
